/**
 * TinyJSEditor is a tiny and small HTML5 + Javascript Editor.
 *
 * @author kurtextrem <kurtextrem@gmail.com>
 * @license CC BY-SA http://creativecommons.org/licenses/by-sa/3.0/
 * @copyright 2011-XXXX
 * @version 0.1
 *
 * Use jquery.tje.js if you want to modify the code!
 */

(function(a){function c(a,b,c,d){c<0&&(c=c+a.length),d=d!==undefined?d:a.length,d<0&&(d=d+a.length-c);return a.slice(0,c)+b.substr(0,d)+b.slice(d)+a.slice(c+d)}function b(b,c){if(typeof c=="undefined")var c={"[b]":"<b>","[i]":"<i>","[s]":"<s>","[o]":'<span style="text-decoration: overline;">',"[u]":'<span style="text-decoration: underline;">',"[/b]":"</b>","[/i]":"</i>","[/s]":"</s>","[/o]":"</span>","[/u]":"</span>"};a.each(c,function(a,c){b=b.replace(a,c)});return b}a.fn.TJE=function(d,e,f){var g=this;g.id=g.prop("id")==""?a.now():g.prop("id");var h={parent_tpl:"<div class='tinyjseditor' id='{textarea_id}'><div class='toolbar'>{button_tpl}<br></div><textarea>{textarea_value}</textarea><div class='wysiwyg' contenteditable>{textarea_value_compiled}</div></div>",button_tpl:"<button class='tje_button tje_{value}'>{value_first}</button>",slider_tpl:"<input type='range' min='0' max='1' value='0' title='Left: Editor, Right: Quellcode(editor)'>",compiled:{button_tpl:"",full_compiled:""}},i={bold:!0,italic:!0,strike:!0,overline:!0,underline:!1,quellcode:!0,editor:!0,render_html:!0},j={textarea_id:g.id,textarea_value:g.val(),textarea_value_compiled:i.render_html?b(g.html()):b(g.text()),button_tpl:""};d&&a.extend(i,d),e&&a.extend(j,e),h&&a.extend(h,f),a.each(i,function(a,b){if(b&&a!="quellcode"&&a!="editor"&&a!="render_html"){var c=h.button_tpl.replace("{value}",a).replace("{value_first}",a.substr(0,1).toUpperCase());h.compiled.button_tpl+=c}else if(b&&a!="render_html"){h.compiled.button_tpl+=h.slider_tpl;return!1}}),j.button_tpl=h.compiled.button_tpl,h.compiled.full_compiled=h.parent_tpl,a.each(j,function(a,b){h.compiled.full_compiled=h.compiled.full_compiled.replace("{"+a+"}",b)}),this.after(h.compiled.full_compiled),this.remove(),a("#"+g.id+" .tje_button").click(function(){var d=a("#"+g.id).find("textarea"),e=a("#"+g.id).find(".wysiwyg"),f=a(this).text();f=f.toLowerCase();if(window.getSelection()=="")d.text(d.val()+"["+f+"][/"+f+"]");else{var h=window.getSelection();console.log(window.getSelection()),c(d.val(),"["+f+"]"+h()+"[/"+f+"]",h.extentOffset,h.anchorOffset-h.extentOffset)}e.html(b(d.val()))}),a("#"+g.id+" input[type=range]").change(function(){a("#"+g.id).find("textarea").toggle(),a("#"+g.id).find(".wysiwyg").toggle()}),a("#"+g.id+" textarea").keyup(function(){var c=a("#"+g.id).find(".wysiwyg");c.html(b(a(this).val()))}),a("#"+g.id+" .wysiwyg").keyup(function(){var c=a("#"+g.id).find("textarea"),d=a(this).text();c.val(d),a(this).html(b(d))}),a("#"+g.id).find("textarea").hide();return a(h.compiled.full_compiled)}})(jQuery)

